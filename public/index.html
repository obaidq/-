<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø£Ø¨Ùˆ Ø¹Ø§Ø¨Ø¯ Ø¨ÙˆÙƒØ³ ğŸ‡¸ğŸ‡¦</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root {
            --primary: #1e3a5f;
            --primary-light: #2d5a87;
            --yellow: #ffd700;
            --pink: #ff2d75;
            --cyan: #00d4ff;
            --green: #00e676;
            --orange: #ff6d00;
            --red: #ff1744;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Tajawal', sans-serif; 
            background: var(--primary); 
            min-height: 100vh; 
            color: #fff; 
            overflow-x: hidden;
        }
        
        /* Background */
        .bg-spiral {
            position: fixed;
            top: 50%; left: 50%;
            width: 250vmax; height: 250vmax;
            background: repeating-conic-gradient(from 0deg at 50% 50%, #1e3a5f 0deg 8deg, #2d5a87 8deg 16deg);
            animation: rotate 180s linear infinite;
            transform: translate(-50%, -50%);
            z-index: -1;
            opacity: 0.7;
        }
        @keyframes rotate { to { transform: translate(-50%, -50%) rotate(360deg); } }
        
        /* Screens */
        .screen { display: none; min-height: 100vh; padding: 20px; flex-direction: column; }
        .screen.active { display: flex; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Buttons */
        .btn {
            font-family: 'Tajawal', sans-serif;
            font-weight: 800;
            border: 4px solid #000;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.15s;
            box-shadow: 6px 6px 0 #000;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:hover { transform: translate(-3px, -3px); box-shadow: 9px 9px 0 #000; }
        .btn:active { transform: translate(2px, 2px); box-shadow: 3px 3px 0 #000; }
        .btn-primary { background: var(--green); color: #000; padding: 18px 45px; font-size: 22px; }
        .btn-secondary { background: var(--yellow); color: #000; padding: 16px 40px; font-size: 20px; }
        .btn-danger { background: var(--red); color: #fff; padding: 14px 30px; font-size: 18px; }
        
        /* Welcome Screen */
        #welcomeScreen { justify-content: center; align-items: center; text-align: center; gap: 25px; }
        
        .mascot { font-size: 100px; animation: bounce 2s ease-in-out infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0) rotate(-5deg); } 50% { transform: translateY(-20px) rotate(5deg); } }
        
        .logo { display: flex; align-items: center; justify-content: center; gap: 15px; flex-wrap: wrap; }
        .logo-box { 
            background: var(--yellow); 
            color: #000; 
            padding: 15px 35px; 
            border: 5px solid #000; 
            border-radius: 18px; 
            font-size: 48px; 
            font-weight: 900; 
            box-shadow: 8px 8px 0 #000; 
            transform: rotate(-4deg); 
        }
        .logo-name { font-size: 56px; font-weight: 900; text-shadow: 4px 4px 0 #000; transform: rotate(3deg); }
        
        .tagline { font-size: 22px; color: var(--yellow); text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        
        .buttons { display: flex; flex-direction: column; gap: 18px; width: 100%; max-width: 380px; }
        
        .badge { 
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); 
            display: flex; align-items: center; gap: 12px; 
            background: rgba(0,80,0,0.4); padding: 12px 28px; border-radius: 50px; 
            border: 2px solid rgba(0,150,0,0.5); font-size: 15px; 
        }
        
        /* Input Screens */
        .input-wrapper { flex: 1; display: flex; align-items: center; justify-content: center; }
        .input-card { 
            background: rgba(0,0,0,0.7); 
            border: 5px solid #000; 
            border-radius: 30px; 
            padding: 45px; 
            max-width: 450px; 
            width: 100%; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.5); 
        }
        .input-title { font-size: 32px; font-weight: 900; text-align: center; margin-bottom: 35px; color: var(--yellow); }
        .input-field { 
            width: 100%; padding: 20px; font-size: 22px; 
            font-family: 'Tajawal', sans-serif; font-weight: 700; 
            border: 4px solid #333; border-radius: 16px; 
            text-align: center; margin-bottom: 18px; 
            background: #fff; color: #000; 
        }
        .input-field:focus { outline: none; border-color: var(--pink); }
        .code-input { letter-spacing: 15px; text-transform: uppercase; font-size: 36px; }
        .input-buttons { display: flex; flex-direction: column; gap: 15px; }
        .input-buttons .btn { width: 100%; }
        
        /* Lobby Screen */
        #lobbyScreen { padding: 25px 20px; gap: 20px; }
        .lobby-header { text-align: center; }
        .lobby-mascot { font-size: 60px; animation: bounce 2s ease-in-out infinite; }
        .lobby-logo { display: flex; align-items: center; justify-content: center; gap: 12px; flex-wrap: wrap; margin: 15px 0; }
        .lobby-logo .logo-box { font-size: 26px; padding: 8px 18px; }
        .lobby-logo .logo-name { font-size: 32px; }
        
        .room-card { 
            background: #fff; border: 5px solid #000; border-radius: 25px; 
            padding: 25px 50px; display: inline-block; box-shadow: 8px 8px 0 #000; margin: 20px 0;
        }
        .room-label { font-size: 13px; color: #888; text-transform: uppercase; letter-spacing: 2px; }
        .room-code { font-size: 50px; font-weight: 900; letter-spacing: 12px; color: var(--primary); }
        
        .players-grid { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin: 20px 0; }
        .player-card { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .player-avatar { 
            width: 70px; height: 70px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 38px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; 
            position: relative; 
        }
        .player-avatar.host::before { content: 'ğŸ‘‘'; position: absolute; top: -18px; right: -8px; font-size: 24px; }
        .player-name { font-size: 16px; font-weight: 800; }
        .player-score { font-size: 13px; color: var(--yellow); }
        
        /* Games Grid */
        .games-section { max-width: 1100px; margin: 0 auto; width: 100%; }
        .games-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 22px; }
        .game-card { 
            background: #fff; border-radius: 20px; overflow: hidden; 
            cursor: pointer; transition: all 0.25s; box-shadow: 0 8px 25px rgba(0,0,0,0.3); 
        }
        .game-card:hover { transform: translateY(-10px); box-shadow: 0 15px 40px rgba(0,0,0,0.4); }
        .game-header { height: 130px; display: flex; align-items: center; justify-content: center; }
        .game-icon { font-size: 65px; filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3)); transition: transform 0.3s; }
        .game-card:hover .game-icon { transform: scale(1.2) rotate(-5deg); }
        .game-body { padding: 20px; text-align: right; }
        .game-title { font-size: 20px; font-weight: 900; color: #222; margin-bottom: 8px; }
        .game-desc { font-size: 13px; color: #666; line-height: 1.5; margin-bottom: 12px; }
        .game-meta { display: flex; gap: 10px; justify-content: flex-end; }
        .meta-tag { background: #f0f0f0; padding: 5px 12px; border-radius: 15px; font-size: 12px; font-weight: 700; color: #555; }
        
        .game-quiplash .game-header { background: linear-gradient(135deg, #667eea, #764ba2); }
        .game-fibbage .game-header { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .game-guesspionage .game-header { background: linear-gradient(135deg, #11998e, #38ef7d); }
        .game-fakinit .game-header { background: linear-gradient(135deg, #fa709a, #fee140); }
        .game-triviamurder .game-header { background: linear-gradient(135deg, #434343, #000000); }
        .game-drawful .game-header { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        
        .lobby-actions { display: flex; gap: 18px; justify-content: center; flex-wrap: wrap; margin-top: 15px; }
        
        /* Game Screen */
        #gameScreen { padding: 0; }
        .game-screen-header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 18px 25px; background: rgba(0,0,0,0.6); 
            border-bottom: 4px solid #000; flex-wrap: wrap; gap: 15px; 
        }
        .game-info { display: flex; align-items: center; gap: 15px; }
        .game-info-icon { font-size: 36px; }
        .game-info-title { font-size: 24px; font-weight: 900; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .game-info-round { font-size: 14px; opacity: 0.8; }
        .game-timer { 
            background: var(--yellow); border: 4px solid #000; border-radius: 50%; 
            width: 65px; height: 65px; display: flex; align-items: center; justify-content: center; 
            font-size: 26px; font-weight: 900; color: #000; box-shadow: 5px 5px 0 #000; 
        }
        .game-timer.warning { background: var(--orange); animation: pulse 0.5s infinite; }
        .game-timer.danger { background: var(--red); color: #fff; animation: pulse 0.3s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        
        .game-content { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px 20px; }
        .game-footer { padding: 18px 25px; background: rgba(0,0,0,0.6); border-top: 4px solid #000; text-align: center; }
        .game-instruction { font-size: 18px; color: var(--yellow); font-weight: 600; }
        
        /* Question Card */
        .question-card { 
            background: #fff; border: 5px solid #000; border-radius: 25px; 
            padding: 35px 45px; max-width: 750px; width: 100%; 
            text-align: center; box-shadow: 10px 10px 0 #000; color: #000; 
            position: relative; 
        }
        .question-badge { 
            position: absolute; top: -20px; right: -20px; 
            background: var(--yellow); border: 4px solid #000; border-radius: 50%; 
            width: 55px; height: 55px; display: flex; align-items: center; justify-content: center; 
            font-size: 26px; font-weight: 900; box-shadow: 4px 4px 0 #000; 
        }
        .question-text { font-size: 26px; font-weight: 800; line-height: 1.5; }
        
        .answer-section { margin-top: 28px; width: 100%; max-width: 550px; }
        .answer-input { 
            width: 100%; padding: 20px; font-size: 22px; 
            font-family: 'Tajawal', sans-serif; font-weight: 700; 
            border: 4px solid #000; border-radius: 16px; text-align: center; 
            box-shadow: 5px 5px 0 #000; margin-bottom: 18px; 
        }
        .answer-input:focus { outline: none; border-color: var(--pink); }
        
        /* Slider */
        .slider-container { width: 100%; max-width: 450px; margin: 25px auto; text-align: center; }
        .percent-display { font-size: 70px; font-weight: 900; color: var(--cyan); text-shadow: 4px 4px 0 #000; }
        .percent-slider { 
            width: 100%; height: 18px; -webkit-appearance: none; 
            background: linear-gradient(90deg, var(--red), var(--yellow), var(--green)); 
            border-radius: 10px; border: 4px solid #000; margin-top: 15px;
        }
        .percent-slider::-webkit-slider-thumb { 
            -webkit-appearance: none; width: 38px; height: 38px; 
            background: #fff; border: 4px solid #000; border-radius: 50%; 
            cursor: pointer; box-shadow: 3px 3px 0 #000; 
        }
        
        /* Voting */
        .voting-title { font-size: 26px; font-weight: 900; color: var(--yellow); text-shadow: 3px 3px 0 #000; margin-bottom: 22px; }
        .voting-section { display: flex; gap: 25px; flex-wrap: wrap; justify-content: center; margin-top: 22px; }
        .vote-card { 
            background: #fff; border: 5px solid #000; border-radius: 20px; 
            padding: 28px 35px; min-width: 230px; max-width: 320px; 
            text-align: center; cursor: pointer; box-shadow: 6px 6px 0 #000; 
            transition: all 0.2s; color: #000; 
        }
        .vote-card:hover { transform: scale(1.06); box-shadow: 9px 9px 0 #000; }
        .vote-card.selected { background: var(--yellow); transform: scale(1.1); }
        .vote-text { font-size: 22px; font-weight: 800; }
        .vs-badge { 
            background: var(--cyan); border: 4px solid #000; border-radius: 50%; 
            width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; 
            font-size: 20px; font-weight: 900; box-shadow: 4px 4px 0 #000; align-self: center; 
        }
        
        /* Options */
        .options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 25px; max-width: 650px; width: 100%; }
        .option-btn { 
            background: #fff; border: 4px solid #000; border-radius: 16px; 
            padding: 20px; font-size: 18px; font-weight: 800; 
            font-family: 'Tajawal', sans-serif; cursor: pointer; 
            box-shadow: 5px 5px 0 #000; transition: all 0.15s; color: #000; 
        }
        .option-btn:hover { transform: translate(-2px, -2px); box-shadow: 7px 7px 0 #000; }
        .option-btn.correct { background: var(--green); }
        .option-btn.wrong { background: var(--red); color: #fff; }
        .option-btn.selected { background: var(--yellow); }
        
        /* Players Vote Grid */
        .players-vote-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 18px; max-width: 700px; width: 100%; margin-top: 22px; }
        .player-vote-card { 
            background: rgba(255,255,255,0.1); border: 4px solid rgba(255,255,255,0.3); 
            border-radius: 18px; padding: 18px; text-align: center; cursor: pointer; transition: all 0.2s; 
        }
        .player-vote-card:hover { background: rgba(255,255,255,0.2); transform: scale(1.05); }
        .player-vote-card.selected { background: var(--pink); border-color: #000; }
        .player-vote-avatar { font-size: 45px; margin-bottom: 8px; }
        .player-vote-name { font-size: 15px; font-weight: 700; }
        
        /* Task Card */
        .task-card { 
            background: linear-gradient(135deg, #667eea, #764ba2); 
            border: 5px solid #000; border-radius: 25px; padding: 38px; 
            max-width: 550px; width: 100%; text-align: center; box-shadow: 10px 10px 0 #000; 
        }
        .task-category { font-size: 16px; color: rgba(255,255,255,0.8); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 3px; }
        .task-text { font-size: 30px; font-weight: 900; line-height: 1.4; }
        .faker-warning { background: var(--red); border: 4px solid #000; border-radius: 15px; padding: 18px; margin-top: 18px; }
        .faker-warning-text { font-size: 22px; font-weight: 900; }
        
        /* Trivia Murder Card */
        .murder-card { 
            background: linear-gradient(135deg, #1a1a2e, #16213e); 
            border: 5px solid var(--red); border-radius: 25px; padding: 38px; 
            max-width: 750px; width: 100%; text-align: center; 
            box-shadow: 0 0 30px rgba(255,0,0,0.3), 10px 10px 0 #000; position: relative; 
        }
        .murder-card::before { content: 'ğŸ’€'; position: absolute; top: -28px; left: 50%; transform: translateX(-50%); font-size: 55px; }
        .murder-question { font-size: 24px; font-weight: 800; color: var(--orange); line-height: 1.5; margin-top: 18px; }
        .alive-badge { 
            display: inline-flex; align-items: center; gap: 6px; 
            background: var(--green); padding: 6px 16px; border-radius: 18px; 
            border: 3px solid #000; font-size: 13px; font-weight: 700; color: #000; margin: 8px 4px; 
        }
        .dead-badge { background: var(--red); color: #fff; text-decoration: line-through; }
        
        /* Death Challenge */
        .death-card { 
            background: linear-gradient(135deg, #8B0000, #4a0000); 
            border: 5px solid #ff0000; border-radius: 25px; padding: 38px; 
            max-width: 480px; width: 100%; text-align: center; 
            box-shadow: 0 0 50px rgba(255,0,0,0.5); animation: deathPulse 1s infinite; 
        }
        @keyframes deathPulse { 0%, 100% { box-shadow: 0 0 30px rgba(255,0,0,0.5); } 50% { box-shadow: 0 0 60px rgba(255,0,0,0.8); } }
        .death-title { font-size: 34px; font-weight: 900; margin-bottom: 18px; }
        .death-question { font-size: 22px; color: var(--orange); margin-bottom: 22px; }
        
        /* Waiting */
        .waiting { text-align: center; padding: 45px; }
        .waiting-icon { font-size: 85px; animation: bounce 2s ease-in-out infinite; }
        .waiting-text { font-size: 24px; margin-top: 22px; font-weight: 700; }
        .waiting-count { font-size: 18px; color: var(--cyan); margin-top: 12px; }
        
        /* Results */
        .results { text-align: center; max-width: 700px; width: 100%; }
        .results-title { font-size: 42px; font-weight: 900; color: var(--yellow); text-shadow: 4px 4px 0 #000; margin-bottom: 28px; }
        .results-card { 
            background: #fff; border: 5px solid #000; border-radius: 25px; 
            padding: 28px; margin-bottom: 22px; box-shadow: 10px 10px 0 #000; color: #000; 
        }
        .winner-answer { font-size: 28px; font-weight: 900; margin-bottom: 12px; }
        .winner-name { font-size: 17px; color: var(--pink); font-weight: 700; }
        .votes-display { display: flex; justify-content: center; gap: 6px; margin-top: 12px; font-size: 26px; }
        
        /* Guesspionage Results */
        .guess-result { 
            display: flex; align-items: center; gap: 14px; padding: 14px 18px; 
            background: rgba(255,255,255,0.1); border-radius: 14px; margin-bottom: 10px; 
            border: 3px solid rgba(255,255,255,0.2); 
        }
        .guess-result.winner { background: var(--green); color: #000; border-color: #000; }
        .result-avatar { font-size: 32px; }
        .result-info { flex: 1; text-align: right; }
        .result-name { font-weight: 800; font-size: 17px; }
        .result-guess { font-size: 13px; opacity: 0.8; }
        .result-points { font-size: 22px; font-weight: 900; color: var(--yellow); }
        .result-arrow { font-size: 28px; }
        
        /* Percentage Circle */
        .percent-circle { 
            width: 180px; height: 180px; border-radius: 50%; 
            background: conic-gradient(var(--cyan) calc(var(--percent) * 1%), #333 0); 
            display: flex; align-items: center; justify-content: center; 
            margin: 28px auto; border: 6px solid #000; box-shadow: 8px 8px 0 #000; position: relative; 
        }
        .percent-circle::before { content: ''; position: absolute; width: 140px; height: 140px; background: var(--primary); border-radius: 50%; }
        .percent-value { position: relative; z-index: 1; font-size: 44px; font-weight: 900; }
        
        /* Scoreboard */
        .scoreboard { 
            background: rgba(0,0,0,0.9); border: 5px solid #000; border-radius: 25px; 
            padding: 22px; max-width: 520px; width: 100%; margin: 22px auto; 
        }
        .scoreboard-title { font-size: 26px; font-weight: 900; color: var(--yellow); text-align: center; margin-bottom: 18px; }
        .score-row { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 14px 16px; background: rgba(255,255,255,0.1); border-radius: 14px; 
            margin-bottom: 9px; border: 3px solid rgba(255,255,255,0.2); 
        }
        .score-row:first-of-type { background: var(--yellow); color: #000; border-color: #000; }
        .score-player { display: flex; align-items: center; gap: 10px; }
        .score-rank { font-size: 20px; font-weight: 900; width: 32px; }
        .score-name { font-weight: 800; font-size: 17px; }
        .score-points { font-size: 26px; font-weight: 900; }
        
        /* Drawing */
        .drawing-box { background: #fff; border: 5px solid #000; border-radius: 25px; padding: 22px; box-shadow: 10px 10px 0 #000; }
        .drawing-prompt { 
            text-align: center; padding: 14px 22px; background: var(--yellow); 
            border: 4px solid #000; border-radius: 14px; margin-bottom: 18px; color: #000; 
            font-size: 18px; font-weight: 800; 
        }
        .drawing-canvas { border: 5px solid #000; border-radius: 14px; cursor: crosshair; touch-action: none; background: #fff; display: block; }
        .drawing-tools { display: flex; gap: 9px; margin-top: 16px; flex-wrap: wrap; justify-content: center; }
        .tool-btn { 
            width: 45px; height: 45px; border: 3px solid #000; border-radius: 11px; 
            cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; 
            box-shadow: 3px 3px 0 #000; background: #fff; 
        }
        .tool-btn.active { background: var(--yellow); }
        .color-btn { border-radius: 50%; }
        .color-btn.active { transform: scale(1.2); box-shadow: 0 0 0 4px var(--yellow); }
        
        /* Toast */
        .toast { 
            position: fixed; top: 22px; left: 50%; transform: translateX(-50%) translateY(-100px); 
            padding: 16px 32px; border-radius: 14px; border: 4px solid #000; 
            box-shadow: 6px 6px 0 #000; z-index: 1000; font-weight: 800; font-size: 17px; 
            animation: toastSlide 0.4s forwards; 
        }
        .toast.error { background: var(--red); color: #fff; }
        .toast.success { background: var(--green); color: #000; }
        @keyframes toastSlide { to { transform: translateX(-50%) translateY(0); } }
        
        /* Confetti */
        .confetti { position: fixed; top: -20px; width: 14px; height: 14px; animation: confettiFall 4s ease-out forwards; z-index: 1000; border-radius: 3px; }
        @keyframes confettiFall { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(1080deg); opacity: 0; } }
        
        /* Final Results */
        #finalResultsScreen { justify-content: center; align-items: center; padding: 30px; }
        .final-content { text-align: center; max-width: 550px; width: 100%; }
        .final-buttons { margin-top: 32px; display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .logo-box { font-size: 30px; padding: 10px 22px; }
            .logo-name { font-size: 38px; }
            .room-code { font-size: 38px; letter-spacing: 8px; }
            .question-text { font-size: 20px; }
            .options-grid { grid-template-columns: 1fr; }
            .voting-section { flex-direction: column; align-items: center; }
            .games-grid { grid-template-columns: 1fr; gap: 18px; }
            .percent-display { font-size: 54px; }
        }
    </style>
</head>
<body>
    <div class="bg-spiral"></div>

    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="screen active">
        <div class="mascot">ğŸ§”ğŸ»</div>
        <div class="logo">
            <span class="logo-box">Ø£Ø¨Ùˆ Ø¹Ø§Ø¨Ø¯</span>
            <span class="logo-name">Ø¨ÙˆÙƒØ³</span>
        </div>
        <p class="tagline">ğŸ‡¸ğŸ‡¦ Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© â€¢ Ø§Ù„Ø¹Ø¨ Ù…Ø¹ Ø±Ø¨Ø¹Ùƒ!</p>
        <div class="buttons">
            <button class="btn btn-primary" onclick="showScreen('createRoomScreen')">ğŸ  Ø£Ù†Ø´Ø¦ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
            <button class="btn btn-secondary" onclick="showScreen('joinRoomScreen')">ğŸšª Ø§Ù†Ø¶Ù… Ù„ØºØ±ÙØ©</button>
        </div>
        <div class="badge"><span>ğŸ‡¸ğŸ‡¦</span><span>ØµÙ†Ø¹ Ø¨ÙØ®Ø± ÙÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</span><span>ğŸŒ´</span></div>
    </div>

    <!-- Create Room Screen -->
    <div id="createRoomScreen" class="screen">
        <div class="input-wrapper">
            <div class="input-card">
                <h2 class="input-title">ğŸ  Ø£Ù†Ø´Ø¦ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                <input type="text" id="hostNameInput" class="input-field" placeholder="Ø§Ø³Ù…Ùƒ..." maxlength="12">
                <div class="input-buttons">
                    <button class="btn btn-primary" onclick="createRoom()">Ø§Ø¨Ø¯Ø£! ğŸš€</button>
                    <button class="btn btn-danger" onclick="showScreen('welcomeScreen')">Ø±Ø¬ÙˆØ¹</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Join Room Screen -->
    <div id="joinRoomScreen" class="screen">
        <div class="input-wrapper">
            <div class="input-card">
                <h2 class="input-title">ğŸšª Ø§Ù†Ø¶Ù… Ù„ØºØ±ÙØ©</h2>
                <input type="text" id="roomCodeInput" class="input-field code-input" placeholder="ABCD" maxlength="4" oninput="this.value=this.value.toUpperCase()">
                <input type="text" id="playerNameInput" class="input-field" placeholder="Ø§Ø³Ù…Ùƒ..." maxlength="12">
                <div class="input-buttons">
                    <button class="btn btn-primary" onclick="joinRoom()">Ø§Ù†Ø¶Ù…! ğŸ®</button>
                    <button class="btn btn-danger" onclick="showScreen('welcomeScreen')">Ø±Ø¬ÙˆØ¹</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Lobby Screen -->
    <div id="lobbyScreen" class="screen">
        <div class="lobby-header">
            <div class="lobby-mascot">ğŸ§”ğŸ»</div>
            <div class="lobby-logo">
                <span class="logo-box">Ø£Ø¨Ùˆ Ø¹Ø§Ø¨Ø¯</span>
                <span class="logo-name">Ø¨ÙˆÙƒØ³</span>
            </div>
            <div class="room-card">
                <div class="room-label">ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</div>
                <div class="room-code" id="displayRoomCode">XXXX</div>
            </div>
        </div>

        <div class="players-grid" id="playersGrid"></div>

        <div class="games-section" id="gamesSection">
            <div class="games-grid">
                <div class="game-card game-quiplash" onclick="selectGame('quiplash')">
                    <div class="game-header"><span class="game-icon">âš¡</span></div>
                    <div class="game-body">
                        <h3 class="game-title">Ø±Ø¯ Ø³Ø±ÙŠØ¹</h3>
                        <p class="game-desc">Ø§ÙƒØªØ¨ Ø£Ø°ÙƒÙ‰ ÙˆØ£Ø·Ø±Ù Ø¥Ø¬Ø§Ø¨Ø©! Ø£ØµØ¯Ù‚Ø§Ø¤Ùƒ ÙŠØµÙˆØªÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙØ¶Ù„</p>
                        <div class="game-meta"><span class="meta-tag">ğŸ‘¥ Ù£-Ù¨</span><span class="meta-tag">â±ï¸ Ù¡Ù¥Ø¯</span></div>
                    </div>
                </div>
                <div class="game-card game-fibbage" onclick="selectGame('fibbage')">
                    <div class="game-header"><span class="game-icon">ğŸ­</span></div>
                    <div class="game-body">
                        <h3 class="game-title">ÙƒØ´Ù Ø§Ù„ÙƒØ°Ø§Ø¨</h3>
                        <p class="game-desc">Ø§ÙƒØªØ¨ ÙƒØ°Ø¨Ø© Ù…Ù‚Ù†Ø¹Ø© ÙˆØ§Ø®Ø¯Ø¹ Ø£ØµØ­Ø§Ø¨Ùƒ!</p>
                        <div class="game-meta"><span class="meta-tag">ğŸ‘¥ Ù¢-Ù¨</span><span class="meta-tag">â±ï¸ Ù¢Ù Ø¯</span></div>
                    </div>
                </div>
                <div class="game-card game-guesspionage" onclick="selectGame('guesspionage')">
                    <div class="game-header"><span class="game-icon">ğŸ“Š</span></div>
                    <div class="game-body">
                        <h3 class="game-title">Ø®Ù…Ù‘Ù† Ø§Ù„Ù†Ø³Ø¨Ø©</h3>
                        <p class="game-desc">Ø®Ù…Ù‘Ù† ÙƒÙ… Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø§Ø³ Ø§Ù„Ù„ÙŠ ÙŠØ³ÙˆÙˆÙ† ÙƒØ°Ø§ØŸ</p>
                        <div class="game-meta"><span class="meta-tag">ğŸ‘¥ Ù¢-Ù¨</span><span class="meta-tag">â±ï¸ Ù¡Ù¥Ø¯</span></div>
                    </div>
                </div>
                <div class="game-card game-fakinit" onclick="selectGame('fakinit')">
                    <div class="game-header"><span class="game-icon">ğŸ•µï¸</span></div>
                    <div class="game-body">
                        <h3 class="game-title">Ø§Ù„Ù…Ø²ÙŠÙ‘Ù</h3>
                        <p class="game-desc">ÙˆØ§Ø­Ø¯ Ù…Ø§ ÙŠØ¹Ø±Ù Ø§Ù„Ù…Ù‡Ù…Ø© - Ø§ÙƒØªØ´ÙÙˆÙ‡!</p>
                        <div class="game-meta"><span class="meta-tag">ğŸ‘¥ Ù£-Ù¦</span><span class="meta-tag">â±ï¸ Ù¡Ù¥Ø¯</span></div>
                    </div>
                </div>
                <div class="game-card game-triviamurder" onclick="selectGame('triviamurder')">
                    <div class="game-header"><span class="game-icon">ğŸ’€</span></div>
                    <div class="game-body">
                        <h3 class="game-title">Ø­ÙÙ„Ø© Ø§Ù„Ù‚Ø§ØªÙ„</h3>
                        <p class="game-desc">Ø£Ø¬Ø¨ ØµØ­ Ø£Ùˆ Ù…Øª! Ø¢Ø®Ø± ÙˆØ§Ø­Ø¯ ÙŠÙÙˆØ²</p>
                        <div class="game-meta"><span class="meta-tag">ğŸ‘¥ Ù¡-Ù¨</span><span class="meta-tag">â±ï¸ Ù¢Ù¥Ø¯</span></div>
                    </div>
                </div>
                <div class="game-card game-drawful" onclick="selectGame('drawful')">
                    <div class="game-header"><span class="game-icon">ğŸ¨</span></div>
                    <div class="game-body">
                        <h3 class="game-title">Ø§Ø±Ø³Ù… Ù„ÙŠ</h3>
                        <p class="game-desc">Ø§Ø±Ø³Ù… Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ÙŠØ© ÙˆØ®Ù„ Ø§Ù„Ø¨Ø§Ù‚ÙŠÙ† ÙŠØ®Ù…Ù†ÙˆÙ†!</p>
                        <div class="game-meta"><span class="meta-tag">ğŸ‘¥ Ù£-Ù¨</span><span class="meta-tag">â±ï¸ Ù¢Ù Ø¯</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="lobby-actions">
            <button class="btn btn-secondary" onclick="toggleReady()">âœ‹ Ø¬Ø§Ù‡Ø²!</button>
            <button class="btn btn-danger" onclick="location.reload()">ğŸšª Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="screen">
        <div class="game-screen-header">
            <div class="game-info">
                <span class="game-info-icon" id="gameIcon">âš¡</span>
                <div>
                    <div class="game-info-title" id="gameTitle">Ø±Ø¯ Ø³Ø±ÙŠØ¹</div>
                    <div class="game-info-round" id="gameRound">Ø§Ù„Ø¬ÙˆÙ„Ø© Ù¡ Ù…Ù† Ù£</div>
                </div>
            </div>
            <div class="game-timer" id="gameTimer">30</div>
            <button class="btn btn-danger" style="padding:10px 18px;font-size:15px;" onclick="if(confirm('Ù…ØªØ£ÙƒØ¯ØŸ'))location.reload()">ğŸšª</button>
        </div>
        <div class="game-content" id="gameContent"></div>
        <div class="game-footer">
            <p class="game-instruction" id="gameInstruction">ğŸ’¡ Ø§ÙƒØªØ¨ Ø£Ø·Ø±Ù Ø¥Ø¬Ø§Ø¨Ø©!</p>
        </div>
    </div>

    <!-- Final Results Screen -->
    <div id="finalResultsScreen" class="screen">
        <div class="final-content">
            <h1 class="results-title">ğŸ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©!</h1>
            <div class="scoreboard" id="finalScoreboard"></div>
            <div class="final-buttons">
                <button class="btn btn-primary" id="playAgainBtn" onclick="socket.emit('backToLobby',currentRoom)">ğŸ”„ Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©</button>
            </div>
        </div>
    </div>

    <script>
        let socket, currentRoom = null, isHost = false, gameTimer = null;
        let canvas, ctx, isDrawing = false, currentColor = '#000', brushSize = 5;
        let answeredCount = 0, totalPlayers = 0;

        function initSocket() {
            socket = io();

            socket.on('roomCreated', d => {
                currentRoom = d.code; isHost = true;
                document.getElementById('displayRoomCode').textContent = d.code;
                updatePlayers(d.players);
                showScreen('lobbyScreen');
                updateHostUI();
                showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©! ğŸ‰', 'success');
            });

            socket.on('roomJoined', d => {
                currentRoom = d.code;
                document.getElementById('displayRoomCode').textContent = d.code;
                updatePlayers(d.players);
                showScreen('lobbyScreen');
                updateHostUI();
                showToast('Ø§Ù†Ø¶Ù…Ù…Øª Ù„Ù„ØºØ±ÙØ©! ğŸ®', 'success');
            });

            socket.on('playerJoined', d => updatePlayers(d.players));
            socket.on('playerLeft', d => {
                updatePlayers(d.players);
                const me = d.players.find(p => p.id === socket.id);
                if (me && me.isHost) { isHost = true; updateHostUI(); }
            });
            socket.on('playerUpdated', d => updatePlayers(d.players));
            socket.on('error', d => showToast(d.message, 'error'));
            
            socket.on('gameStarted', d => {
                totalPlayers = d.players.length;
                showScreen('gameScreen');
                updateGameHeader(d.game);
            });

            socket.on('playerAnswered', d => {
                answeredCount = d.count;
                updateWaitingCount();
            });

            // Game Events
            socket.on('quiplashQuestion', handleQuiplashQuestion);
            socket.on('quiplashVoting', handleQuiplashVoting);
            socket.on('quiplashResults', handleQuiplashResults);
            socket.on('fibbageQuestion', handleFibbageQuestion);
            socket.on('fibbageVoting', handleFibbageVoting);
            socket.on('fibbageResults', handleFibbageResults);
            socket.on('guesspionageQuestion', handleGuesspionageQuestion);
            socket.on('guesspionageResults', handleGuesspionageResults);
            socket.on('fakinItTask', handleFakinItTask);
            socket.on('fakinItVoting', handleFakinItVoting);
            socket.on('fakinItResults', handleFakinItResults);
            socket.on('triviaMurderQuestion', handleTriviaMurderQuestion);
            socket.on('triviaMurderResults', handleTriviaMurderResults);
            socket.on('deathChallenge', handleDeathChallenge);
            socket.on('deathChallengeResults', handleDeathChallengeResults);
            socket.on('drawfulPrompt', handleDrawfulPrompt);
            socket.on('gameEnded', handleGameEnded);
            socket.on('returnedToLobby', d => { updatePlayers(d.players); showScreen('lobbyScreen'); });
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function showToast(msg, type) {
            const t = document.createElement('div');
            t.className = 'toast ' + type;
            t.textContent = (type === 'error' ? 'âš ï¸ ' : 'âœ… ') + msg;
            document.body.appendChild(t);
            setTimeout(() => { t.style.animation = 'toastSlide 0.3s ease reverse forwards'; setTimeout(() => t.remove(), 300); }, 3000);
        }

        function createConfetti() {
            const colors = ['#ffd700', '#ff2d75', '#00d4ff', '#00e676', '#7c4dff', '#ff6d00'];
            for (let i = 0; i < 50; i++) {
                const c = document.createElement('div');
                c.className = 'confetti';
                c.style.left = Math.random() * 100 + 'vw';
                c.style.background = colors[Math.floor(Math.random() * colors.length)];
                c.style.animationDelay = Math.random() * 2 + 's';
                document.body.appendChild(c);
                setTimeout(() => c.remove(), 5000);
            }
        }

        function createRoom() {
            const name = document.getElementById('hostNameInput').value.trim();
            if (!name) return showToast('Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ!', 'error');
            socket.emit('createRoom', name);
        }

        function joinRoom() {
            const code = document.getElementById('roomCodeInput').value.trim().toUpperCase();
            const name = document.getElementById('playerNameInput').value.trim();
            if (!code || code.length !== 4) return showToast('ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦!', 'error');
            if (!name) return showToast('Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ!', 'error');
            socket.emit('joinRoom', { code, playerName: name });
        }

        function toggleReady() { socket.emit('playerReady', currentRoom); }

        function selectGame(game) {
            if (!isHost) return showToast('Ø§Ù„Ù…Ø¶ÙŠÙ ÙÙ‚Ø· ÙŠØ®ØªØ§Ø±!', 'error');
            socket.emit('startGame', { code: currentRoom, game });
        }

        function updatePlayers(players) {
            totalPlayers = players.length;
            document.getElementById('playersGrid').innerHTML = players.map(p => 
                '<div class="player-card"><div class="player-avatar ' + (p.isHost ? 'host' : '') + '" style="background:' + p.color + '">' + p.avatar + '</div><div class="player-name">' + p.name + '</div><div class="player-score">' + p.score + ' Ù†Ù‚Ø·Ø©</div></div>'
            ).join('');
        }

        function updateHostUI() {
            document.getElementById('gamesSection').style.display = isHost ? 'block' : 'none';
        }

        function updateGameHeader(game) {
            const g = { quiplash: { i: 'âš¡', t: 'Ø±Ø¯ Ø³Ø±ÙŠØ¹', n: 'Ø§ÙƒØªØ¨ Ø£Ø·Ø±Ù Ø¥Ø¬Ø§Ø¨Ø©!' }, fibbage: { i: 'ğŸ­', t: 'ÙƒØ´Ù Ø§Ù„ÙƒØ°Ø§Ø¨', n: 'Ø§ÙƒØªØ¨ ÙƒØ°Ø¨Ø© Ù…Ù‚Ù†Ø¹Ø©!' }, guesspionage: { i: 'ğŸ“Š', t: 'Ø®Ù…Ù‘Ù† Ø§Ù„Ù†Ø³Ø¨Ø©', n: 'Ø®Ù…Ù‘Ù† Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©!' }, fakinit: { i: 'ğŸ•µï¸', t: 'Ø§Ù„Ù…Ø²ÙŠÙ‘Ù', n: 'Ø§ÙƒØªØ´Ù Ø§Ù„Ù…Ø²ÙŠÙ‘Ù!' }, triviamurder: { i: 'ğŸ’€', t: 'Ø­ÙÙ„Ø© Ø§Ù„Ù‚Ø§ØªÙ„', n: 'Ø£Ø¬Ø¨ ØµØ­ Ø£Ùˆ Ù…Øª!' }, drawful: { i: 'ğŸ¨', t: 'Ø§Ø±Ø³Ù… Ù„ÙŠ', n: 'Ø§Ø±Ø³Ù… Ø§Ù„ÙƒÙ„Ù…Ø©!' } };
            const info = g[game] || g.quiplash;
            document.getElementById('gameIcon').textContent = info.i;
            document.getElementById('gameTitle').textContent = info.t;
            document.getElementById('gameInstruction').textContent = 'ğŸ’¡ ' + info.n;
        }

        function startTimer(sec) {
            let t = sec;
            const el = document.getElementById('gameTimer');
            el.textContent = t;
            el.className = 'game-timer';
            if (gameTimer) clearInterval(gameTimer);
            gameTimer = setInterval(() => {
                t--;
                el.textContent = t;
                if (t <= 10) el.classList.add('warning');
                if (t <= 5) { el.classList.remove('warning'); el.classList.add('danger'); }
                if (t <= 0) clearInterval(gameTimer);
            }, 1000);
        }

        function showWaiting(msg) {
            answeredCount = 1;
            document.getElementById('gameContent').innerHTML = '<div class="waiting"><div class="waiting-icon">â³</div><p class="waiting-text">' + msg + '</p><p class="waiting-count" id="waitingCount">Ù¡ Ù…Ù† ' + totalPlayers + '</p></div>';
        }

        function updateWaitingCount() {
            const el = document.getElementById('waitingCount');
            if (el) el.textContent = answeredCount + ' Ù…Ù† ' + totalPlayers;
        }

        // QUIPLASH
        function handleQuiplashQuestion(d) {
            document.getElementById('gameRound').textContent = 'Ø§Ù„Ø¬ÙˆÙ„Ø© ' + d.round + ' Ù…Ù† ' + d.maxRounds;
            startTimer(d.timeLimit);
            document.getElementById('gameContent').innerHTML = '<div class="question-card"><div class="question-badge">' + d.round + '</div><p class="question-text">' + d.question + '</p></div><div class="answer-section"><input type="text" class="answer-input" id="answerInput" placeholder="Ø¥Ø¬Ø§Ø¨ØªÙƒ..." maxlength="100"><button class="btn btn-primary" onclick="submitQuiplash()">Ø¥Ø±Ø³Ø§Ù„ âš¡</button></div>';
            setTimeout(function() { var el = document.getElementById('answerInput'); if (el) el.focus(); }, 100);
        }

        function submitQuiplash() {
            var a = document.getElementById('answerInput').value.trim();
            if (!a) return showToast('Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨Ø©!', 'error');
            socket.emit('submitQuiplashAnswer', { code: currentRoom, answer: a });
            showWaiting('Ù†Ù†ØªØ¸Ø± Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†...');
        }

        function handleQuiplashVoting(d) {
            startTimer(d.timeLimit);
            var html = '<div class="question-card" style="margin-bottom:22px;"><p class="question-text">' + d.question + '</p></div><h3 class="voting-title">ğŸ—³ï¸ ØµÙˆÙ‘Øª Ù„Ù„Ø£ÙØ¶Ù„!</h3><div class="voting-section">';
            d.answers.forEach(function(a, i) {
                html += '<div class="vote-card" onclick="voteQuiplash(\'' + a.playerId + '\')"><p class="vote-text">"' + a.answer + '"</p></div>';
                if (i === 0) html += '<div class="vs-badge">VS</div>';
            });
            html += '</div>';
            document.getElementById('gameContent').innerHTML = html;
        }

        function voteQuiplash(id) {
            document.querySelectorAll('.vote-card').forEach(function(c) { c.classList.remove('selected'); });
            event.currentTarget.classList.add('selected');
            socket.emit('submitQuiplashVote', { code: currentRoom, votedPlayerId: id });
        }

        function handleQuiplashResults(d) {
            clearInterval(gameTimer);
            createConfetti();
            var w = d.results[0];
            var html = '<div class="results"><h2 class="results-title">ğŸ† Ø§Ù„ÙØ§Ø¦Ø²!</h2><div class="results-card"><p class="winner-answer">"' + w.answer + '"</p><p class="winner-name">- ' + w.playerName + '</p><div class="votes-display">';
            for (var i = 0; i < w.votes; i++) html += 'ğŸ‘';
            html += '</div></div><div class="scoreboard"><h3 class="scoreboard-title">ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>';
            d.results.forEach(function(r, i) {
                html += '<div class="score-row"><div class="score-player"><span class="score-rank">' + (i + 1) + '</span><span class="score-name">' + r.playerName + '</span></div><span class="score-points">+' + (r.votes * 100) + '</span></div>';
            });
            html += '</div>';
            if (isHost) html += '<button class="btn btn-primary" style="margin-top:22px;" onclick="socket.emit(\'requestNextRound\',currentRoom)">' + (d.isLastRound ? 'Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ğŸ†' : 'Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© â¡ï¸') + '</button>';
            html += '</div>';
            document.getElementById('gameContent').innerHTML = html;
        }

        // FIBBAGE
        function handleFibbageQuestion(d) {
            document.getElementById('gameRound').textContent = 'Ø§Ù„Ø¬ÙˆÙ„Ø© ' + d.round + ' Ù…Ù† ' + d.maxRounds;
            startTimer(d.timeLimit);
            document.getElementById('gameContent').innerHTML = '<div class="question-card"><div class="question-badge">ğŸ­</div><p class="question-text">' + d.question + '</p></div><div class="answer-section"><input type="text" class="answer-input" id="lieInput" placeholder="ÙƒØ°Ø¨ØªÙƒ..." maxlength="50"><button class="btn btn-primary" onclick="submitFibbage()">Ø¥Ø±Ø³Ø§Ù„ ğŸ­</button></div>';
            setTimeout(function() { var el = document.getElementById('lieInput'); if (el) el.focus(); }, 100);
        }

        function submitFibbage() {
            var l = document.getElementById('lieInput').value.trim();
            if (!l) return showToast('Ø§ÙƒØªØ¨ ÙƒØ°Ø¨Ø©!', 'error');
            socket.emit('submitFibbageLie', { code: currentRoom, lie: l });
            showWaiting('Ù†Ù†ØªØ¸Ø± Ø§Ù„ÙƒØ°Ø§Ø¨ÙŠÙ†...');
        }

        function handleFibbageVoting(d) {
            startTimer(d.timeLimit);
            var html = '<div class="question-card" style="margin-bottom:22px;"><p class="question-text">' + d.question + '</p></div><h3 class="voting-title">ğŸ” Ø§Ø®ØªØ± Ø§Ù„ØµØ­ÙŠØ­Ø©!</h3><div class="options-grid">';
            d.options.forEach(function(o) {
                html += '<button class="option-btn" onclick="guessFibbage(\'' + o.id + '\')">' + o.text + '</button>';
            });
            html += '</div>';
            document.getElementById('gameContent').innerHTML = html;
        }

        function guessFibbage(id) {
            document.querySelectorAll('.option-btn').forEach(function(b) { b.disabled = true; b.style.opacity = '0.6'; });
            event.currentTarget.classList.add('selected');
            event.currentTarget.style.opacity = '1';
            socket.emit('submitFibbageGuess', { code: currentRoom, guessId: id });
        }

        function handleFibbageResults(d) {
            clearInterval(gameTimer);
            createConfetti();
            var html = '<div class="results"><h2 class="results-title">ğŸ­ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©!</h2><div class="results-card"><p class="winner-answer">"' + d.correctAnswer + '"</p></div><div class="scoreboard"><h3 class="scoreboard-title">ğŸ“Š Ù…Ù† Ø®Ø¯Ø¹ Ù…Ù†ØŸ</h3>';
            d.results.forEach(function(r, i) {
                html += '<div class="score-row"><div class="score-player"><span class="score-rank">' + (i + 1) + '</span><span class="score-name">' + r.playerName + '</span></div><span class="score-points">+' + r.pointsEarned + '</span></div>';
            });
            html += '</div>';
            if (isHost) html += '<button class="btn btn-primary" style="margin-top:22px;" onclick="socket.emit(\'requestNextRound\',currentRoom)">' + (d.isLastRound ? 'Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ğŸ†' : 'Ø§Ù„ØªØ§Ù„ÙŠØ© â¡ï¸') + '</button>';
            html += '</div>';
            document.getElementById('gameContent').innerHTML = html;
        }

        // GUESSPIONAGE
        function handleGuesspionageQuestion(d) {
            document.getElementById('gameRound').textContent = 'Ø§Ù„Ø¬ÙˆÙ„Ø© ' + d.round + ' Ù…Ù† ' + d.maxRounds;
            startTimer(d.timeLimit);
            document.getElementById('gameContent').innerHTML = '<div class="question-card"><div class="question-badge">ğŸ“Š</div><p class="question-text">' + d.question + '</p></div><div class="slider-container"><div class="percent-display" id="percentDisplay">50%</div><input type="range" class="percent-slider" id="percentSlider" min="0" max="100" value="50" oninput="updatePercent(this.value)"><button class="btn btn-primary" style="margin-top:22px;" onclick="submitGuess()">ØªØ£ÙƒÙŠØ¯ ğŸ“Š</button></div>';
        }

        function updatePercent(val) { document.getElementById('percentDisplay').textContent = val + '%'; }

        function submitGuess() {
            var g = document.getElementById('percentSlider').value;
            socket.emit('submitGuess', { code: currentRoom, guess: g });
            showWaiting('Ù†Ù†ØªØ¸Ø± Ø§Ù„ØªØ®Ù…ÙŠÙ†Ø§Øª...');
        }

        function handleGuesspionageResults(d) {
            clearInterval(gameTimer);
            createConfetti();
            var html = '<div class="results"><h2 class="results-title">ğŸ“Š Ø§Ù„Ù†ØªÙŠØ¬Ø©!</h2><div class="question-card" style="margin-bottom:18px;"><p class="question-text" style="font-size:18px;">' + d.question + '</p></div><div class="percent-circle" style="--percent:' + d.correctAnswer + '"><span class="percent-value">' + d.correctAnswer + '%</span></div><div class="scoreboard" style="background:transparent;border:none;box-shadow:none;">';
            d.results.forEach(function(r, i) {
                html += '<div class="guess-result ' + (i === 0 ? 'winner' : '') + '"><span class="result-avatar">' + r.avatar + '</span><div class="result-info"><div class="result-name">' + r.playerName + '</div><div class="result-guess">Ø®Ù…Ù‘Ù†: ' + r.guess + '% ' + r.accuracy + '</div></div><span class="result-arrow">' + (r.isHigher ? 'â¬†ï¸' : 'â¬‡ï¸') + '</span><span class="result-points">+' + r.points + '</span></div>';
            });
            html += '</div>';
            if (isHost) html += '<button class="btn btn-primary" style="margin-top:22px;" onclick="socket.emit(\'requestNextRound\',currentRoom)">' + (d.isLastRound ? 'Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ğŸ†' : 'Ø§Ù„ØªØ§Ù„ÙŠØ© â¡ï¸') + '</button>';
            html += '</div>';
            document.getElementById('gameContent').innerHTML = html;
        }

        // FAKIN IT
        function handleFakinItTask(d) {
            document.getElementById('gameRound').textContent = 'Ø§Ù„Ø¬ÙˆÙ„Ø© ' + d.round + ' Ù…Ù† ' + d.maxRounds;
            startTimer(d.timeLimit);
            var html;
            if (d.isFaker) {
                html = '<div class="task-card" style="background:linear-gradient(135deg,#8B0000,#4a0000);"><div class="task-category">' + d.category + '</div><div class="faker-warning"><div class="faker-warning-text">ğŸ•µï¸ Ø£Ù†Øª Ø§Ù„Ù…Ø²ÙŠÙ‘Ù!</div></div><p class="task-text" style="margin-top:18px;">Ù…Ø§ ØªØ¹Ø±Ù Ø§Ù„Ù…Ù‡Ù…Ø©! ØªØµØ±Ù Ø·Ø¨ÙŠØ¹ÙŠ!</p></div><button class="btn btn-secondary" style="margin-top:22px;" onclick="submitFakinAction()">Ø¬Ø§Ù‡Ø²! ğŸ­</button>';
            } else {
                html = '<div class="task-card"><div class="task-category">' + d.category + '</div><p class="task-text">' + d.task + '</p></div><button class="btn btn-secondary" style="margin-top:22px;" onclick="submitFakinAction()">Ø¬Ø§Ù‡Ø²! âœ…</button>';
            }
            document.getElementById('gameContent').innerHTML = html;
        }

        function submitFakinAction() {
            socket.emit('submitFakinAction', { code: currentRoom, action: 'done' });
            showWaiting('Ù†Ù†ØªØ¸Ø± Ø§Ù„Ø¬Ù…ÙŠØ¹...');
        }

        function handleFakinItVoting(d) {
            startTimer(d.timeLimit);
            var html = '<div class="question-card" style="margin-bottom:22px;"><p class="question-text">Ø§Ù„Ù…Ù‡Ù…Ø©: "' + d.task + '"</p></div><h3 class="voting-title">ğŸ•µï¸ Ù…Ù† Ø§Ù„Ù…Ø²ÙŠÙ‘ÙØŸ</h3><div class="players-vote-grid">';
            d.players.forEach(function(p) {
                html += '<div class="player-vote-card" onclick="voteFaker(\'' + p.id + '\')"><div class="player-vote-avatar">' + p.avatar + '</div><div class="player-vote-name">' + p.name + '</div></div>';
            });
            html += '</div>';
            document.getElementById('gameContent').innerHTML = html;
        }

        function voteFaker(id) {
            document.querySelectorAll('.player-vote-card').forEach(function(c) { c.classList.remove('selected'); });
            event.currentTarget.classList.add('selected');
            socket.emit('voteFaker', { code: currentRoom, suspectId: id });
        }

        function handleFakinItResults(d) {
            clearInterval(gameTimer);
            createConfetti();
            var html = '<div class="results"><h2 class="results-title">' + (d.caught ? 'ğŸ‰ Ø§Ù†ÙƒØ´Ù!' : 'ğŸ•µï¸ Ù†Ø¬Ø§!') + '</h2><div class="results-card"><p class="winner-answer">Ø§Ù„Ù…Ø²ÙŠÙ‘Ù: ' + d.fakerName + '</p><p class="winner-name">' + (d.caught ? 'Ø§ÙƒØªØ´ÙØªÙˆÙ‡! ğŸ¯' : 'Ù…Ø§ Ø§ÙƒØªØ´ÙØªÙˆÙ‡! ğŸ˜…') + '</p></div><div class="scoreboard"><h3 class="scoreboard-title">ğŸ“Š Ø§Ù„Ù†Ù‚Ø§Ø·</h3>';
            d.players.sort(function(a, b) { return b.score - a.score; }).forEach(function(p, i) {
                html += '<div class="score-row"><div class="score-player"><span class="score-rank">' + (i + 1) + '</span><span>' + p.avatar + '</span><span class="score-name">' + p.name + '</span></div><span class="score-points">' + p.score + '</span></div>';
            });
            html += '</div>';
            if (isHost) html += '<button class="btn btn-primary" style="margin-top:22px;" onclick="socket.emit(\'requestNextRound\',currentRoom)">' + (d.isLastRound ? 'Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ğŸ†' : 'Ø§Ù„ØªØ§Ù„ÙŠØ© â¡ï¸') + '</button>';
            html += '</div>';
            document.getElementById('gameContent').innerHTML = html;
        }

        // TRIVIA MURDER
        function handleTriviaMurderQuestion(d) {
            document.getElementById('gameRound').textContent = 'Ø§Ù„Ø¬ÙˆÙ„Ø© ' + d.round + ' Ù…Ù† ' + d.maxRounds;
            startTimer(d.timeLimit);
            var aliveHtml = '';
            d.alivePlayers.forEach(function(p) { aliveHtml += '<span class="alive-badge">' + p.avatar + ' ' + p.name + '</span>'; });
            var html = '<div class="murder-card"><p class="murder-question">' + d.question + '</p></div><div class="options-grid" style="margin-top:28px;">';
            d.options.forEach(function(o, i) {
                html += '<button class="option-btn" onclick="answerTrivia(' + i + ',this)">' + o + '</button>';
            });
            html += '</div><div style="margin-top:22px;"><p style="font-size:13px;color:#888;margin-bottom:8px;">Ø§Ù„Ø£Ø­ÙŠØ§Ø¡:</p>' + aliveHtml + '</div>';
            document.getElementById('gameContent').innerHTML = html;
        }

        function answerTrivia(i, btn) {
            document.querySelectorAll('.option-btn').forEach(function(b) { b.disabled = true; b.style.opacity = '0.6'; });
            btn.classList.add('selected');
            btn.style.opacity = '1';
            socket.emit('submitTriviaAnswer', { code: currentRoom, answerIndex: i });
        }

        function handleTriviaMurderResults(d) {
            clearInterval(gameTimer);
            document.querySelectorAll('.option-btn').forEach(function(b, i) {
                if (i === d.correctIndex) b.classList.add('correct');
                else if (b.classList.contains('selected')) b.classList.add('wrong');
            });
            setTimeout(function() {
                var deadMsg = d.newlyDead.length > 0 ? 'ğŸ’€ Ù…Ø§Øª: ' + d.newlyDead.join(', ') : 'âœ… Ø§Ù„ÙƒÙ„ Ù†Ø¬Ø§!';
                var html = '<div class="results"><h2 class="results-title">' + (d.newlyDead.length > 0 ? 'ğŸ’€ Ø§Ù„Ù‚Ø§ØªÙ„ ÙŠÙ‡Ø¬Ù…!' : 'âœ… Ø§Ù„ÙƒÙ„ Ù†Ø¬Ø§!') + '</h2><div class="results-card" style="background:linear-gradient(135deg,#1a1a2e,#16213e);color:#fff;"><p class="winner-answer" style="color:var(--green);">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: ' + d.correctAnswer + '</p><p class="winner-name" style="color:var(--red);">' + deadMsg + '</p></div><div class="scoreboard">';
                d.results.forEach(function(r) {
                    html += '<div class="score-row" style="' + (!r.isAlive ? 'opacity:0.4;text-decoration:line-through;' : '') + '"><div class="score-player"><span>' + (r.isAlive ? 'ğŸ˜Š' : 'ğŸ’€') + '</span><span>' + r.avatar + '</span><span class="score-name">' + r.playerName + '</span></div><span class="score-points">' + r.score + '</span></div>';
                });
                html += '</div>';
                if (isHost) html += '<button class="btn btn-primary" style="margin-top:22px;" onclick="socket.emit(\'requestNextRound\',currentRoom)">' + (d.isLastRound ? 'Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ğŸ†' : 'Ø§Ù„ØªØ§Ù„ÙŠØ© â¡ï¸') + '</button>';
                html += '</div>';
                document.getElementById('gameContent').innerHTML = html;
            }, 2500);
        }

        function handleDeathChallenge(d) {
            startTimer(d.timeLimit);
            document.getElementById('gameContent').innerHTML = '<div class="death-card"><div class="death-title">âš°ï¸ ØªØ­Ø¯ÙŠ Ø§Ù„Ù†Ø¬Ø§Ø©!</div><p class="death-question">' + d.question + '</p><input type="text" class="answer-input" id="deathAnswer" placeholder="Ø£Ø¬Ø¨ Ø¨Ø³Ø±Ø¹Ø©!" style="background:#fff;color:#000;"><button class="btn btn-danger" style="margin-top:14px;" onclick="submitDeathChallenge()">Ø¥Ø±Ø³Ø§Ù„! ğŸ’€</button></div>';
            setTimeout(function() { var el = document.getElementById('deathAnswer'); if (el) el.focus(); }, 100);
        }

        function submitDeathChallenge() {
            var a = document.getElementById('deathAnswer').value.trim();
            socket.emit('submitDeathChallenge', { code: currentRoom, answer: a });
            showWaiting('Ù†Ù†ØªØ¸Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø©...');
        }

        function handleDeathChallengeResults(d) {
            if (d.survivors.length > 0) showToast('ğŸ‰ Ù†Ø¬Ø§: ' + d.survivors.join(', '), 'success');
        }

        // DRAWFUL
        function handleDrawfulPrompt(d) {
            document.getElementById('gameRound').textContent = 'Ø§Ù„Ø¬ÙˆÙ„Ø© ' + d.round + ' Ù…Ù† ' + d.maxRounds;
            startTimer(d.timeLimit);
            document.getElementById('gameContent').innerHTML = '<div class="drawing-box"><div class="drawing-prompt">Ø§Ø±Ø³Ù…: <strong>' + d.prompt + '</strong></div><canvas id="drawingCanvas" class="drawing-canvas" width="360" height="280"></canvas><div class="drawing-tools"><button class="tool-btn color-btn active" style="background:#000" onclick="setColor(\'#000\',this)"></button><button class="tool-btn color-btn" style="background:#E23636" onclick="setColor(\'#E23636\',this)"></button><button class="tool-btn color-btn" style="background:#1e3a5f" onclick="setColor(\'#1e3a5f\',this)"></button><button class="tool-btn color-btn" style="background:#00e676" onclick="setColor(\'#00e676\',this)"></button><button class="tool-btn color-btn" style="background:#ffd700" onclick="setColor(\'#ffd700\',this)"></button><button class="tool-btn" onclick="brushSize=3">â€¢</button><button class="tool-btn" onclick="brushSize=10">â—</button><button class="tool-btn" onclick="clearCanvas()">ğŸ—‘ï¸</button></div></div><button class="btn btn-primary" style="margin-top:22px;" onclick="submitDrawing()">ØªÙ…! ğŸ–¼ï¸</button>';
            initCanvas();
        }

        function initCanvas() {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            canvas.onmousedown = function(e) { isDrawing = true; draw(e); };
            canvas.onmousemove = draw;
            canvas.onmouseup = canvas.onmouseout = function() { isDrawing = false; ctx.beginPath(); };
            canvas.ontouchstart = function(e) { e.preventDefault(); isDrawing = true; };
            canvas.ontouchmove = function(e) {
                e.preventDefault();
                var t = e.touches[0];
                var r = canvas.getBoundingClientRect();
                ctx.strokeStyle = currentColor;
                ctx.lineWidth = brushSize;
                ctx.lineTo(t.clientX - r.left, t.clientY - r.top);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(t.clientX - r.left, t.clientY - r.top);
            };
            canvas.ontouchend = function() { isDrawing = false; ctx.beginPath(); };
        }

        function draw(e) {
            if (!isDrawing) return;
            var r = canvas.getBoundingClientRect();
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = brushSize;
            ctx.lineTo(e.clientX - r.left, e.clientY - r.top);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(e.clientX - r.left, e.clientY - r.top);
        }

        function setColor(c, btn) {
            currentColor = c;
            document.querySelectorAll('.color-btn').forEach(function(b) { b.classList.remove('active'); });
            btn.classList.add('active');
        }

        function clearCanvas() {
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function submitDrawing() {
            socket.emit('submitDrawing', { code: currentRoom, drawing: canvas.toDataURL() });
            showWaiting('Ù†Ù†ØªØ¸Ø± Ø§Ù„ÙÙ†Ø§Ù†ÙŠÙ†...');
        }

        // GAME ENDED
        function handleGameEnded(d) {
            clearInterval(gameTimer);
            createConfetti();
            var html = '<h3 class="scoreboard-title">ğŸ† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h3>';
            d.finalResults.forEach(function(p, i) {
                var rank = i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : (i + 1);
                html += '<div class="score-row"><div class="score-player"><span class="score-rank">' + rank + '</span><span style="font-size:26px;">' + p.avatar + '</span><span class="score-name">' + p.name + '</span></div><span class="score-points">' + p.score + '</span></div>';
            });
            document.getElementById('finalScoreboard').innerHTML = html;
            document.getElementById('playAgainBtn').style.display = isHost ? 'inline-flex' : 'none';
            showScreen('finalResultsScreen');
        }

        document.addEventListener('DOMContentLoaded', initSocket);
    </script>
</body>
</html>
